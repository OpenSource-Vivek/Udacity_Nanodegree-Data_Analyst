Exploration of Facebook Data
===========================================
```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
getwd()
list.files()
facebook <- read.csv("pseudo_facebook.tsv", sep = '\t')
names(facebook)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_Libraries}
library(knitr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(alr3)
library(GGally)
library(gridExtra)
library(reshape2)
```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

## Histogram of Users' Birthdays

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Users_Birthdays}
names(facebook)
qplot(x = dob_day, data = facebook) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = 1:31)
```

##Histogram of Users' Birthdays with Month Wrap

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Users_Birthdays_Month}
ggplot(data = facebook, aes(x = dob_day)) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = 1:31) +
  facet_wrap(~dob_month)
```

## Friend Count

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Friend_Count}
ggplot(data = subset(facebook, !is.na(gender)), aes(x = friend_count)) +
  geom_histogram(binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 50)) +
  facet_wrap(~gender)
```

## Statistics by Gender

```{r echo=FALSE, message=FALSE, warning=FALSE, Statistics-Gender}
table(facebook$gender)
by(facebook$friend_count, facebook$gender, summary)
```

## Tenure

```{r echo=FALSE, message=FALSE, warning=FALSE, Tenure}
ggplot(data = facebook, aes(x = tenure)) +
  geom_histogram(binwidth = 30, color = 'black', fill = '#099DD9') +
  xlab('Number of days using Facebook') +
  ylab('Number of users in sample')

ggplot(aes(x = tenure/365), data = facebook) + 
  geom_histogram(binwidth = .25, color = 'black', fill = '#F79420') +
  scale_x_continuous(limits = c(0, 7), breaks = seq(1, 7, 1)) +
  xlab('Number of years using Facebook') +
  ylab('Number of users in sample')
```

## User Ages

```{r echo=FALSE, message=FALSE, warning=FALSE, User Ages}
ggplot(aes(x = age), data = facebook) + 
  geom_histogram(binwidth = 1, color = 'black', fill = '#5760AB') +
  scale_x_continuous(limits = c(10, 105), breaks = seq(10, 105, 5)) +
  xlab('Age of Facebook Users') +
  ylab('Number of users in sample')
```

## Transforming Data

```{r echo=FALSE, message=FALSE, warning=FALSE, Transoform-Data}
summary(facebook$friend_count)
summary(log10(facebook$friend_count+1))
summary(sqrt(facebook$friend_count))

plot_1 <- ggplot(data = facebook, aes(x = friend_count)) +
  geom_histogram(binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 50))
plot_2 <- ggplot(data = facebook, aes(x = log10(friend_count+1))) +
  geom_histogram(binwidth = .2) +
  scale_x_continuous(limits = c(0, 4), breaks = seq(0, 4, 1))
plot_3 <- ggplot(data = facebook, aes(x = sqrt(friend_count))) +
  geom_histogram(binwidth = 1) +
  scale_x_continuous(limits = c(0, 70), breaks = seq(0, 70, 5))

grid.arrange(plot_1, plot_2, plot_3, ncol=1)
```

## Transforming Data Using Scales

```{r echo=FALSE, message=FALSE, warning=FALSE, Transoform-Data-Scales}
p1 <- ggplot(data = facebook, aes(x = friend_count)) +
  geom_histogram()
p2 <- p1 + scale_x_log10()
p3 <- p1 + scale_x_sqrt()

grid.arrange(p1, p2, p3, ncol = 1)
```

## Add a Scaling Layer
```{r echo=FALSE, message=FALSE, warning=FALSE, Scaling-Layer}
logScale <- ggplot(data = facebook, aes(x = log10(friend_count+1))) +
  geom_histogram()

countScale <- ggplot(data = facebook, aes(friend_count)) +
  geom_histogram() +
  scale_x_log10()

grid.arrange(logScale, countScale, ncol = 2)
```

## Frequency Polygons (Different then Histograms)
```{r echo=FALSE, message=FALSE, warning=FALSE, Frequency_Polygrams}
ggplot(data = subset(facebook, !is.na(gender)), aes(x = friend_count)) +
  geom_histogram(binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 50)) +
  facet_wrap(~gender) +
  xlab('Friend Count') +
  ylab('Number of users in sample')

ggplot(data = subset(facebook, !is.na(gender)), aes(x = friend_count)) +
  geom_freqpoly(aes(color = gender), binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 50)) +
  xlab('Friend Count') +
  ylab('Percentage of Users with Friend Count')

ggplot(data = subset(facebook, !is.na(gender)), aes(x = friend_count, y = ..density../sum(..density..))) +
  geom_freqpoly(aes(color = gender), binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000), breaks = seq(0, 1000, 50)) +
  facet_wrap(~gender) +
  xlab('Friend Count') +
  ylab('Percentage of Users with Friend Count')

ggplot(data = subset(facebook, !is.na(gender)), aes(x = www_likes, y = ..count../sum(..count..))) +
  geom_freqpoly(aes(color = gender)) + 
  scale_x_log10() +
  xlab('Number of Likes') +
  ylab('Number of Users')
```

## Numerical Functions

```{r echo=FALSE, message=FALSE, warning=FALSE, Numberical_Features}
by(facebook$www_likes, facebook$gender, sum)
```

## Box Plots and Quartiles

```{r echo=FALSE, message=FALSE, warning=FALSE, Box_Plots}
ggplot(data = subset(facebook, !is.na(gender)), 
       aes(x = gender, y = friend_count)) +
  geom_boxplot() +
  scale_y_continuous(limits = c(0, 1000))

ggplot(data = subset(facebook, !is.na(gender)), 
       aes(x = gender, y = friend_count)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 1000))

by(facebook$friend_count, facebook$gender, summary)
```

## Box Plots Continued
```{r echo=FALSE, message=FALSE, warning=FALSE, Box_Plots_2}
ggplot(data = subset(facebook, !is.na(gender)),
       aes(x = gender, y = friendships_initiated)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0,150))

by(facebook$friendships_initiated, facebook$gender, summary)
```

## Getting Logical
```{r echo=FALSE, message=FALSE, warning=FALSE, Logic}
summary(facebook$mobile_likes)
summary(facebook$mobile_likes > 0)

facebook$mobile_check_in <- NA
facebook$mobile_check_in <- ifelse(facebook$mobile_likes > 0, 1, 0)
facebook$mobile_check_in <- factor(facebook$mobile_check_in)

summary(facebook$mobile_check_in)
(sum(facebook$mobile_check_in == 1)/length(facebook$mobile_check_in))*100
```

## Scatterplots

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot}
ggplot(data = facebook, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20) +
  xlim(13, 90)
```

# Overplotting

```{r echo=FALSE, message=FALSE, warning=FALSE, Overplotting}
ggplot(data = facebook, aes(x = age, y = friend_count)) +
  geom_jitter(alpha = 1/20) +
  xlim(13, 90)
```

## Transformed Cartesian Coordinate System

```{r echo=FALSE, message=FALSE, warning=FALSE, Transform-Coordinates}
ggplot(data = facebook, aes(x = age, y = friend_count)) +
  geom_point(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(13, 90) +
  coord_trans(y = "sqrt")
```

# Alpha and Jitter

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Alpha_Jitter}
ggplot(data = facebook, aes(x = age, y = friendships_initiated)) +
  geom_point(alpha = 1/10, position = position_jitter(h = 0)) +
  xlim(13, 90) +
  coord_trans(y = "sqrt")

ggplot(data = facebook, aes(x = age, y =friendships_initiated)) +
  geom_jitter(alpha = 1/10) +
  xlim(13, 90)
```

## Conditional Means

```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_1}
age_groups <- group_by(facebook, age)
facebook.friend_count_by_age <- summarise(age_groups,
          friend_count_mean = mean(friend_count),
          friend_count_median = median(as.numeric(friend_count)),
          n = n())
facebook.friend_count_by_age <- arrange(facebook.friend_count_by_age)

facebook.friend_count_by_age
```

## Conditional Means Alternate Code

```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_2}
facebook.friend_count_by_age_2 <- facebook %>%
  group_by(age) %>%
  summarise(friend_count_mean = mean(friend_count),
            friend_count_median = median(friend_count),
            n = n()) %>%
  arrange(age)

facebook.friend_count_by_age_2
```

## Conditional Mean Plot

```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Mean_Plot}
ggplot(data = facebook.friend_count_by_age, aes(age, friend_count_mean)) +
  geom_line()
```

## Overlaying Summaries with Raw Data

```{r echo=FALSE, message=FALSE, warning=FALSE, Summaries-Raw}
ggplot(aes(x = age, y = friend_count), data = facebook) +
  coord_cartesian(xlim = c(13, 70), ylim = c(0, 1000)) +
  geom_point(alpha = 0.05, 
             position = position_jitter(h = 0),
             color = 'orange') +
  geom_line(stat = 'summary', fun.y = mean) +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .1),
            linetype = 2,
            color = 'blue') +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .5),
            color = 'blue') +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .9),
            linetype = 2,
            color = 'blue')
```

## Correlation
```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation}
cor.test(facebook$age, facebook$friend_count, method = 'pearson')

with(facebook, cor.test(age, friend_count, method = 'pearson'))
```

## Correlation on Subsets
```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Subset}
with(subset(facebook, age <= 70), cor.test(age, friend_count, method = 'pearson'))
```

## Correlation Methods
```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Method}
with(subset(facebook, age <= 70), 
     cor.test(age, friend_count, method = 'spearman'))

with(subset(facebook, age <= 70), 
     cor.test(age, friend_count, method = 'kendall'))
```

## Scatterplots

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot_2}
ggplot(data = facebook, aes(x = www_likes_received, y = likes_received)) +
  geom_point(alpha = 0.1, 
             color = 'blue') +
  coord_cartesian(xlim = c(0, 12500), ylim = c(0, 25000))
```

# Strong Correlations

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Strong}
ggplot(data = facebook, aes(x = www_likes_received, y = likes_received)) +
  geom_point() +
  xlim(0, quantile(facebook$www_likes_received, 0.95)) +
  ylim(0, quantile(facebook$likes_received, 0.95)) +
  geom_smooth(method = 'lm', color = 'red')

cor.test(facebook$www_likes_received,
         facebook$likes_received,
         method = 'pearson')
```

## More Caution with Correlation

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Caution}
data(Mitchell)

ggplot(data = Mitchell, aes(x = Month, y = Temp)) +
  geom_point() +
  scale_x_continuous(breaks = seq(0, 203, 12))

cor.test(Mitchell$Month,
         Mitchell$Temp,
         method = 'pearson')
```

## A New Perspective

```{r echo=FALSE, message=FALSE, warning=FALSE, Perspective}
ggplot(data = Mitchell, aes(x = (Month%%12), y = Temp)) +
  geom_point() +
  scale_x_continuous(breaks = seq(0, 203, 12))

x <- seq(0, 4*pi, pi/20)
y <- cos(x)
qplot(x = x, y = y)
```

## Understanding Noise: Age to Age Months

```{r echo=FALSE, message=FALSE, warning=FALSE, Noise}
ggplot(data = facebook.friend_count_by_age, 
       aes(x = age, y = friend_count_mean)) +
  geom_line()

facebook.friend_count_by_age[17:19,]

facebook$age_with_months <- facebook$age + (1 - facebook$dob_month / 12)
```

## Age with Months Means

```{r echo=FALSE, message=FALSE, warning=FALSE, Age-Month}
facebook.friend_count_by_age_months <- facebook %>%
  group_by(age_with_months) %>%
  summarise(friend_count_mean = mean(friend_count),
            friend_count_median = median(friend_count),
            n = n()) %>%
  arrange(age_with_months)

age_with_months_groups <- group_by(facebook, age_with_months)
facebook.friend_count_by_age_months_2 <- summarise(age_with_months_groups,
                                                   friend_count_mean =
                                                     mean(friend_count),
                                                   friend_count_median =
                                                     median(friend_count),
                                                   n = n())
facebook.friend_count_by_age_months_2 <- 
  arrange(facebook.friend_count_by_age_months_2, age_with_months)

facebook.friend_count_by_age_months
facebook.friend_count_by_age_months_2
```

## Noise in Conditional Means
```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_Noise}
ggplot(data = subset(facebook.friend_count_by_age_months, age_with_months < 71),
       aes(x = age_with_months, y = friend_count_mean)) +
  geom_line()
```

# Smoothing Conditional Means
```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_Smoothing}
plot_1 <- ggplot(data = subset(facebook.friend_count_by_age,
                     age < 71),
       aes(x = age, y = friend_count_mean)) +
  geom_line() +
  geom_smooth()

plot_2 <- ggplot(data = subset(facebook.friend_count_by_age_months,
                     age_with_months < 71),
       aes(x = age_with_months, y = friend_count_mean)) +
  geom_line() +
  geom_smooth()

plot_3 <- ggplot(data = subset(facebook, age <71),
                 aes(x = round(age/5)*5, y = friend_count)) +
  geom_line(stat = 'summary', fun.y = mean)


grid.arrange(plot_2, plot_1, plot_3, ncol = 1)
```

## Third Qualitative Variable
```{r}
ggplot(data = subset(facebook, !is.na(gender)),
       aes(x = gender, y = age)) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = "point", shape = 4)

ggplot(data = subset(facebook, !is.na(gender)),
       aes(x = age, y = friend_count)) +
  geom_line(aes(color = gender), stat = "summary", fun.y = median)

friend_count_by_age_gender <- facebook %>%
  filter(!is.na(gender)) %>%
  group_by(age, gender) %>%
  summarise(mean_friend_count = mean(friend_count),
            median_friend_count = median(as.numeric(friend_count)),
            n = n()) %>%
  ungroup() %>%
  arrange(age)
```

## Plotting Conditional Summaries
```{r}
ggplot(data = friend_count_by_age_gender,
      aes(x = age, y = median_friend_count)) +
  geom_line(aes(color= gender))
```

```{r}
friend_count_by_age_gender_wide <- spread(subset(friend_count_by_age_gender, 
               select = c('gender', 'age', 'median_friend_count')),
        gender,
        median_friend_count)

friend_count_by_age_gender_wide
```

## Ratio Plot
```{r}
ggplot(data = friend_count_by_age_gender_wide,
       aes(x = age, y = female/male)) +
  geom_line() +
  geom_hline(yintercept = 1, alpha = 0.3, linetype = 2)
```

## Third Quantitative Variable
```{r}
facebook$year_joined <- floor(2014 - facebook$tenure/365)
```

## Cut a Variable
```{r}
summary(facebook$year_joined)
table(facebook$year_joined)

facebook$year_joined_bucket <- cut(facebook$year_joined,
                                   c(2004, 2009, 2011, 2012, 2014))
```

## Plotting It All Together
```{r}
table(facebook$year_joined_bucket, useNA = 'ifany')

ggplot(data = subset(facebook, !is.na(year_joined_bucket)),
       aes(x = age, y = friend_count)) + 
  geom_line(aes(color = year_joined_bucket),
            stat = 'summary', 
            fun.y = median)
```

## Plot the Grand Mean
```{r}
ggplot(data = subset(facebook, !is.na(year_joined_bucket)),
       aes(x = age, y = friend_count)) + 
  geom_line(stat = 'summary',
            fun.y = mean,
            aes(color = year_joined_bucket)) +
  geom_line(stat = 'summary', 
            fun.y = mean, 
            linetype = 2)
```

## Friending Rate
```{r}
with(subset(facebook, tenure >= 1), summary(friend_count/tenure))
```

## Friendships Initiated
```{r}
ggplot(data = subset(facebook, tenure >= 1),
       aes(x = tenure, y = friendships_initiated / tenure)) +
  geom_line(stat = 'summary',
            fun.y = mean,
            aes(color = year_joined_bucket))
```

## Bias-Variance Tradeoff Revisited
```{r}
ggplot(data = subset(facebook, tenure >= 1),
       aes(x = tenure, y = friendships_initiated / tenure)) +
  geom_smooth(aes(color = year_joined_bucket))
```

## Scatterplot Matrices
```{r}
theme_set(theme_minimal(20))
set.seed(1836)
facebook_subset <- facebook[, c(2,6:12)]
names(facebook_subset)
ggpairs(facebook_subset[sample.int(nrow(facebook_subset), 1000),])

with(facebook_subset, cor.test(friendships_initiated, friend_count, method = 'pearson'))
with(facebook_subset, cor.test(age, mobile_likes, method = 'pearson'))
```

## Proportion of Friendships Initiated
```{r}
names(facebook)
facebook$prop_initiated <- facebook$friendships_initiated/facebook$friend_count
```

## Proportion Initiated Vs. Tenure
```{r}
facebook$year_joined_bucket <- cut(facebook$year_joined,
                                   c(2004, 2009, 2011, 2012, 2014))

ggplot(data = facebook,
       aes(x = tenure, y = prop_initiated)) +
  geom_line(stat = "summary",
            fun.y = median,
            aes(color = year_joined_bucket))
```


## Smoothing Proportion Initiated vs. Tenure
```{r}
ggplot(data = facebook,
       aes(x = tenure, y = prop_initiated)) +
  geom_line(stat = "summary",
            fun.y = median,
            aes(color = year_joined_bucket)) + 
  geom_smooth()

subset_facebook <- subset(facebook, year_joined > 2012)
summary(subset_facebook$prop_initiated)
```
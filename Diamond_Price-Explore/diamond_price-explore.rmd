---
title: "Exploration of Diamond Pricing"
author: "Paul Foley"
output: html_document
---

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_Libraries}
library(ggplot2)
library(dplyr)
library(gridExtra)
```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
data(diamonds)
```

In this data exploration we will use the diamond data provided by ggplot 2 to explore how Price is effected by it's various features:

* Cut
* Carat
* Color
* Clarity
* Volume
* Depth
* Table

## Diamond Data Summary

```{r echo=FALSE, message=FALSE, warning=FALSE, Summary}
summary(diamonds)
?diamonds
```

## Price Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Summary-Price}
summary(diamonds$price)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Price}
ggplot(data = diamonds, 
       aes(x = price)) +
  geom_histogram(binwidth = 100) +
  scale_x_continuous(limits = c(0, 20000),
                     breaks = seq(0, 20000, 1000)) +
  xlab('Price') +
  ylab('Number of Diamonds') +
  ggtitle('Price Histogram')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Price-Cheap}
ggplot(data = diamonds,
       aes(x = price)) +
  geom_histogram(binwidth = 10) +
  scale_x_continuous(limits = c(0, 2000),
                     breaks = seq(0, 2000, 200)) +
  xlab('Price') +
  ylab('Number of Diamonds') +
  ggtitle("Diamonds under $2000")
```

## Price by Cut Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Price-Cut}
by(diamonds$price, diamonds$cut, summary)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Boxplot-Price-Cut}
ggplot(data = diamonds,
       aes(x = cut, y = price)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 10000)) +
  ggtitle("Boxplots - Price Vs. Cut")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Price-Cut}
ggplot(data = diamonds,
       aes(x = price)) +
  geom_histogram(binwidth = 100) +
  scale_x_continuous(limits = c(0, 20000),
                     breaks = seq(0, 20000, 2000)) +
  facet_wrap(~cut,
             scales='free_y') +
  xlab('Price') +
  ylab('Number of Diamonds') +
  ggtitle('Histograms - Price Group By Cut')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Price-Carat-Cut}
ggplot(data = diamonds,
       aes(x = price/carat)) +
  geom_histogram() +
  scale_x_log10() +
  facet_wrap(~cut,
             scales='free_y') +
  xlab('Price Per Carat') +
  ylab('Number of Diamonds') +
  ggtitle('Histograms - Price per Carat Group By Cut')
```

## Price By Carat Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Price-Carat}
summary(diamonds$price/diamonds$carat)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Carat}
ggplot(data = diamonds,
       aes(x = carat,
           y = price)) +
  geom_point(alpha = 1/20,
             color = 'yellow') +
  xlim(0, quantile(diamonds$carat, 0.99)) +
  ylim(0, quantile(diamonds$price, 0.99)) +
  geom_smooth(method = 'lm',
              color = 'red') +
  ggtitle('Scatterplot - Price Vs. Carat')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Frequency-Carat}
ggplot(data = diamonds,
       aes(x = carat)) +
  geom_freqpoly(binwidth = .01) +
  scale_x_continuous(limits = c(0, 3),
                     breaks = seq(0, 3, 1)) +
  xlab('Weight') +
  ylab('Number of Diamonds') +
  ggtitle('Frequency Polygon - Carat')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Carat-Colored}
diamonds$price_per_carat <- diamonds$price / diamonds$carat

ggplot(data = diamonds,
       aes(x = cut,
           y = price_per_carat)) +
  geom_jitter(alpha = .5,
              aes(color = color)) +
  facet_wrap(~clarity) +
  scale_color_brewer(type = 'div') +
  ggtitle('Scatterplots - Price Per Carat Vs. Cut Group By Clarity, Color by Color')
```

## Price By Color Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Price-Color}
by(diamonds$price, diamonds$color, summary)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, IQR-Price-Color}
ggplot(data = diamonds,
       aes(x = color, y = price)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 10000)) +
  ggtitle('Interquartile Range (IQR) - Price Vs. Color')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Boxplots-Price-Carat}
ggplot(data = diamonds,
       aes(x = color,
           y = price/carat)) +
  geom_boxplot() +
  coord_cartesian(ylim = c(0, 7500)) +
  ggtitle('Boxplots - Price Per Carat Vs. Color')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Facet-Color}
ggplot(data = diamonds,
       aes(x = price)) +
  geom_histogram(aes(fill = cut)) +
  facet_wrap(~color) +
  scale_fill_brewer(palette = "Spectral") +
  scale_x_log10() +
  ggtitle('Histogram - Price Group By Color, Color By Cut')
```

## Price By Clarity Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Barchart-Mean-Price}
diamondsByClarity <- diamonds %>%
  group_by(clarity) %>%
  summarise(mean_price = mean(price),
            median_price = median(price),
            min_price = min(price),
            max_price = max(price),
            n = n()) %>%
  arrange(clarity)

diamonds_by_clarity <- group_by(diamonds, clarity)
diamonds_mp_by_clarity <- summarise(diamonds_by_clarity, 
                                    mean_price = mean(price))

diamonds_by_color <- group_by(diamonds, color)
diamonds_mp_by_color <- summarise(diamonds_by_color,
                                 mean_price = mean(price))

diamond_clarity_plot <- ggplot(data = diamonds_mp_by_clarity, 
                               aes(x = clarity, y = mean_price)) +
  geom_bar(stat="identity") +
  ggtitle('Bar Chart - Mean Price Vs. Clarity')

diamond_color_plot <- ggplot(data = diamonds_mp_by_color,
                             aes(x = color, y = mean_price)) +
  geom_bar(stat="identity") +
  ggtitle('Bar Chart - Mean Price Vs. Color')

grid.arrange(diamond_clarity_plot, diamond_color_plot)
```

## Price By X, Y, Z Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlations-Price}
with(diamonds, cor.test(price, x, method = 'pearson'))
with(diamonds, cor.test(price, y, method = 'pearson'))
with(diamonds, cor.test(price, z, method = 'pearson'))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-X}
ggplot(data = diamonds,
       aes(x = x, y = price)) +
  geom_point(alpha = 1/20,
             color = 'blue')+
  xlim(3,10) +
  ggtitle('Scatterplot - Price Vs. X')
```

### Correlation - Price Vs. Volume

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Price-Volume}
diamonds$volume <- diamonds$x * diamonds$y + diamonds$z
volume_df <- subset(diamonds, volume > 0 & volume < 800)

cor.test(volume_df$price, volume_df$volume, method = "pearson")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Volume}


ggplot(data = diamonds,
       aes(x = volume,
           y = price)) +
  geom_point(alpha = 1/20,
             color = 'orange') +
  xlim(0, quantile(diamonds$volume, 0.99)) +
  ylim(0, quantile(diamonds$price, 0.99)) +
  geom_smooth(method = 'lm',
              color = 'red') +
  ggtitle('Scatterplot - Price Vs. Volume')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Volume-2}
ggplot(data = volume_df,
       aes(x = volume,
           y = price)) +
  geom_point(alpha = 1/20,
             color = 'pink') +
  xlim(0, quantile(volume_df$volume, 0.99)) +
  ylim(0, quantile(volume_df$price, 0.9)) +
  geom_smooth(method = 'lm',
              color = 'red') +
  ggtitle('Scatterplot - Price Vs. Volume Filtered')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Volume-Clarity}
diamonds$volume <- diamonds$x * diamonds$y * diamonds$z

ggplot(data = diamonds,
       aes(x = volume, 
           y = price)) +
  geom_point(aes(color = clarity)) +
  scale_color_brewer(type = 'div') +
  xlim(0, quantile(diamonds$volume, 0.99)) +
  scale_y_log10() +
  ggtitle('Scatterplot - Price Vs. Volume Color By Clarity')
```

## Price By Depth Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Price-Depth}
with(diamonds, cor.test(price, depth, method = 'pearson'))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Price-Depth}
ggplot(data = diamonds, aes(x = depth,
                            y = price)) +
  geom_point(alpha = .02,
             color = 'purple') +
  scale_x_continuous(limits = c(56, 66),
                     breaks = seq(58, 64, 2)) +
  ggtitle('Scatterplot - Price Vs. Depth')
```

## Price by Table Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Table-Price-Cut}
ggplot(data = diamonds,
       aes(x = table,
           y = price)) +
  geom_point(aes(color = cut)) +
  scale_color_brewer(type = 'qual') +
  xlim(50, 80) + 
  ggtitle('Scatterplot - Price Vs. Table Group By Cut')
```

---
title: "Exploration of Facebook Data"
author: "Paul Foley"
output: html_document
---

Exploration of Facebokk Users using sample FB data.

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_Libraries}
library(ggplot2)
library(GGally)
library(dplyr)
library(tidyr)
library(alr3)
library(knitr)
library(gridExtra)
library(reshape2)
```

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
facebook <- read.csv("pseudo_facebook.tsv", sep = '\t')
names(facebook)
```

## Explore Friend Count

```{r echo=FALSE, message=FALSE, warning=FALSE, Friend-Count}
plot_1 <- ggplot(data = facebook,
                 aes(x = friend_count)) +
  geom_histogram(binwidth = 25,
                 fill = 'blue') +
  scale_x_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 50)) +
  xlab('Friend Count') +
  ylab('Number of Users in Sample') +
  ggtitle('Histogram - Friend Count')

plot_2 <- ggplot(data = facebook,
                 aes(x = log10(friend_count+1))) +
  geom_histogram(binwidth = .2,
                 fill = 'blue') +
  scale_x_continuous(limits = c(0, 4),
                     breaks = seq(0, 4, 1)) +
  xlab('Friend Count (log10)') +
  ylab('Number of Users in Sample') +
  ggtitle('Histogram - Friend Count (log10)')

plot_3 <- ggplot(data = facebook,
                 aes(x = sqrt(friend_count))) +
  geom_histogram(binwidth = 1,
                 fill = 'blue') +
  scale_x_continuous(limits = c(0, 70),
                     breaks = seq(0, 70, 5)) +
  xlab('Friend Count (sqrt)') +
  ylab('Number of Users in Sample') +
  ggtitle('Histogram - Friend Count (sqrt)')

grid.arrange(plot_1, plot_2, plot_3, ncol=1)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scaling-Layer}
ggplot(data = facebook,
                     aes(friend_count)) +
  geom_histogram(binwidth = .1,
    fill = 'blue') +
  scale_x_log10() +
  xlab('Friend Count') +
  ylab('Number of Users in Sample') +
  ggtitle('Histogram - Friend Count (log10)')
```

## Birthday Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Users_Birthdays}
ggplot(data = facebook,
       aes(x = dob_day)) +
  geom_histogram(binwidth = 1,
                 fill = 'purple') +
  scale_x_continuous(breaks = 1:31) +
  xlab('Day of Birth') +
  ylab('Number of Users in sample') +
  ggtitle("Histogram - Birthdays")
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Users_Birthdays_Month}
ggplot(data = facebook, 
       aes(x = dob_day)) +
  geom_histogram(binwidth = 1,
                 fill = 'purple') +
  scale_x_continuous(breaks = seq(1,31,5)) +
  facet_wrap(~dob_month) +
  xlab('Day of Birth') +
  ylab('Number of Users in sample') +
  ggtitle('Histogram - Birthdays \n Group By Month')
```

## Gender Exploration

### Count of Genders

```{r echo=FALSE, message=FALSE, warning=FALSE, Count-Gender}
table(facebook$gender)
```

### Summary of Genders
```{r echo=FALSE, message=FALSE, warning=FALSE, Summary-Gender}
by(facebook$friend_count, facebook$gender, summary)
```

### Friendship Counts By Gender

```{r echo=FALSE, message=FALSE, warning=FALSE, Summary-Gender-Friendship_Count}
by(facebook$friend_count, facebook$gender, summary)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Gender-Friend_Count}
ggplot(data = subset(facebook,
                     !is.na(gender)),
       aes(x = friend_count)) +
  geom_histogram(binwidth = 20,
                 fill = 'blue') +
  scale_x_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 200)) +
  facet_wrap(~gender) +
  xlab('Friend Count') +
  ylab('Number of Users in sample') +
  ggtitle('Histogram - Friend Count \n Group By Gender')
```


```{r echo=FALSE, message=FALSE, warning=FALSE, Freq-Gender-Friend_Count-Overlay}
ggplot(data = subset(facebook,
                     !is.na(gender)),
       aes(x = friend_count)) +
  geom_freqpoly(aes(color = gender),
                binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 50)) +
  xlab('Friend Count') +
  ylab('Users with Friend Count')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Freq-Gender-Friend_Count}
ggplot(data = subset(facebook,
                     !is.na(gender)),
       aes(x = friend_count,
           y = ..density../sum(..density..))) +
  geom_freqpoly(aes(color = gender),
                binwidth = 25) +
  scale_x_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 100)) +
  facet_wrap(~gender) +
  xlab('Friend Count') +
  ylab('Percentage of Users with Friend Count')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Boxplot-Gender-Friend_Count}
ggplot(data = subset(facebook,
                     !is.na(gender)), 
       aes(x = gender,
           y = friend_count)) +
  geom_boxplot(color = 'blue') +
  coord_cartesian(ylim = c(0, 1000))
```

### Friendships Initiated By Gender

```{r echo=FALSE, message=FALSE, warning=FALSE, Histogram-Gender-Friend_Init}
by(facebook$friendships_initiated, facebook$gender, summary)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Box_Plot-Gender-Friend_Init}
ggplot(data = subset(facebook,
                     !is.na(gender)),
       aes(x = gender,
           y = friendships_initiated)) +
  geom_boxplot(fill = 'light blue') +
  coord_cartesian(ylim = c(0,150))
```

### Likes by Gender

```{r echo=FALSE, message=FALSE, warning=FALSE, Numberical_Features}
by(facebook$www_likes, facebook$gender, sum)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Freq-Gender-Likes}
ggplot(data = subset(facebook,
                     !is.na(gender)), 
       aes(x = www_likes,
           y = ..count../sum(..count..))) +
  geom_freqpoly(binwidth = .25,
                aes(color = gender)) + 
  scale_x_log10() +
  xlab('Number of Likes') +
  ylab('Number of Users')
```

## Tenure Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Tenure-Days}
ggplot(data = facebook, aes(x = tenure)) +
  geom_histogram(binwidth = 30, 
                 color = 'black', 
                 fill = '#099DD9') +
  xlab('Number of days using Facebook') +
  ylab('Number of users in sample') +
  ggtitle('Histogram - Days Using Facebook')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Tenure-Years}
ggplot(aes(x = tenure/365), data = facebook) + 
  geom_histogram(binwidth = .25, color = 'black', fill = '#F79420') +
  scale_x_continuous(limits = c(0, 7), breaks = seq(1, 7, 1)) +
  xlab('Number of years using Facebook') +
  ylab('Number of users in sample') +
  ggtitle('Histogram - Years Using Facebook')
```

## Exploration Age

```{r echo=FALSE, message=FALSE, warning=FALSE, User Ages}
ggplot(data = facebook,
       aes(x = age)) + 
  geom_histogram(binwidth = 1,
                 color = 'black',
                 fill = '#5760AB') +
  scale_x_continuous(limits = c(10, 105),
                     breaks = seq(10, 105, 5)) +
  xlab('Age (Years) of Facebook Users') +
  ylab('Number of users in sample') +
  ggtitle('Histogram - User Age')
```

### Age and Friend Count

```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means-Friend_Count}
facebook.friend_count_by_age <- facebook %>%
  group_by(age) %>%
  summarise(friend_count_mean = mean(friend_count),
            friend_count_median = median(friend_count),
            n = n()) %>%
  arrange(age)

facebook$age_with_months <- facebook$age + (1 - facebook$dob_month / 12)
```

#### Correlation Age and Friend Count

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Friend_Count-Age}
with(facebook, cor.test(age, friend_count, method = 'pearson'))
```

#### Correlation Age and Friend Count < 70

##### Pearson Correlation

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Subset-Pearson}
with(subset(facebook, age <= 70), cor.test(age, friend_count, method = 'pearson'))
```

##### Spearman Correlation

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Subset-Spearman}
with(subset(facebook, age <= 70), cor.test(age, friend_count, method = 'spearman'))


```

##### Kendall Correlation

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-Subset-Kendall}
with(subset(facebook, age <= 70), cor.test(age, friend_count, method = 'kendall'))
```

#### Scatterplots Age and Friend Count

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Friend_Count-Age}
ggplot(data = facebook,
       aes(x = age,
           y = friend_count)) +
  geom_point(alpha = .1,
             color = 'blue') +
  xlim(13, 90) +
  xlab('User Age') +
  ylab('Friend Count') +
  ggtitle('Scatterplot - Friend Count Vs. Age')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Line-Friend_Count-Age}
ggplot(data = facebook.friend_count_by_age,
       aes(age, friend_count_mean)) +
  geom_line(color = 'blue') +
  xlim(13, 90) +
  xlab('User Age') +
  ylab('Friend Count (sqrt)') +
  ggtitle('Scatterplot - Friend Count (Mean) Vs. Age')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Friend_Count_Sqrt-Age}
ggplot(data = facebook,
       aes(x = age,
           y = friend_count)) +
  geom_point(alpha = .1,
             position = position_jitter(h = 0),
             color = 'blue') +
  xlim(13, 90) +
  coord_trans(y = "sqrt") +
  xlab('User Age') +
  ylab('Friend Count (sqrt)') +
  ggtitle('Scatterplot - Friend Count (sqrt) Vs. Age')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Summaries-Friend_Count-Age}
ggplot(data = facebook,
       aes(x = age,
           y = friend_count)) +
  coord_cartesian(xlim = c(13, 70),
                  ylim = c(0, 1000)) +
  geom_point(alpha = 0.05, 
             position = position_jitter(h = 0),
             color = 'blue') +
  geom_line(stat = 'summary',
            fun.y = mean) +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .1),
            linetype = 2,
            color = 'orange') +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .5),
            color = 'orange') +
  geom_line(stat = 'summary', 
            fun.y = quantile,
            fun.args = list(probs = .9),
            linetype = 2,
            color = 'orange') +
  xlab('User Age') +
  ylab('Friend Count') +
  ggtitle('Scatterplot - Friend Count Vs. Age')
```

### Age and Friendships Initiated

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Friend_Init-Age}
ggplot(data = facebook,
       aes(x = age,
           y =friendships_initiated)) +
  geom_jitter(alpha = .1,
              color = 'light blue') +
  xlim(13, 90) +
  xlab('User Age') +
  ylab('Friendships Initiated') +
  ggtitle('Scatterplot - Friendships Initiated Vs. Age')
```


```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-Friend_Init_Sqrt-Age}
ggplot(data = facebook,
       aes(x = age,
           y = friendships_initiated)) +
  geom_point(alpha = .1,
             position = position_jitter(h = 0),
             color = 'light blue') +
  xlim(13, 90) +
  coord_trans(y = "sqrt") +
  xlab('User Age') +
  ylab('Friendships Initiated (sqrt)') +
  ggtitle('Scatterplot - \n Friendships Initiated (sqrt) Vs. Age')
```





## Mobile Likes Explore

```{r echo=FALSE, message=FALSE, warning=FALSE, Logic}
summary(facebook$mobile_likes)
summary(facebook$mobile_likes > 0)

facebook$mobile_check_in <- NA
facebook$mobile_check_in <- ifelse(facebook$mobile_likes > 0, 1, 0)
facebook$mobile_check_in <- factor(facebook$mobile_check_in)

summary(facebook$mobile_check_in)
(sum(facebook$mobile_check_in == 1)/length(facebook$mobile_check_in))*100
```

## Likes Recieved Exploration

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-likes-www_likes}
ggplot(data = facebook,
       aes(x = www_likes_received,
           y = likes_received)) +
  geom_point(alpha = 0.1, 
             color = 'dark blue') +
  geom_smooth(method = 'lm',
              color = 'red') +
  coord_cartesian(xlim = c(0, 12500),
                  ylim = c(0, 25000)) +
  xlab('www Likes Received') +
  ylab('Likes Received') +
  ggtitle('Scatterplot - Likes Received')
```

### Correlation Likes Received and www Likes Received

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation-likes-www_likes}
cor.test(facebook$www_likes_received, facebook$likes_received, method = 'pearson')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Scatterplot-likes-www_likes-zoom}
ggplot(data = facebook,
       aes(x = www_likes_received,
           y = likes_received)) +
  geom_point(color = 'dark blue') +
  xlim(0, quantile(facebook$www_likes_received, 0.95)) +
  ylim(0, quantile(facebook$likes_received, 0.95)) +
  geom_smooth(method = 'lm', color = 'red') +
  xlab('www Likes Received') +
  ylab('Likes Received') +
  ggtitle('Scatterplot - Likes Received Zoomed In')

```



## Age with Months Means

```{r echo=FALSE, message=FALSE, warning=FALSE, Age-Month}
facebook.friend_count_by_age_months <- facebook %>%
  group_by(age_with_months) %>%
  summarise(friend_count_mean = mean(friend_count),
            friend_count_median = median(friend_count),
            n = n()) %>%
  arrange(age_with_months)

age_with_months_groups <- group_by(facebook, age_with_months)
facebook.friend_count_by_age_months_2 <- summarise(age_with_months_groups,
                                                   friend_count_mean =
                                                     mean(friend_count),
                                                   friend_count_median =
                                                     median(friend_count),
                                                   n = n())
facebook.friend_count_by_age_months_2 <- 
  arrange(facebook.friend_count_by_age_months_2, age_with_months)

facebook.friend_count_by_age_months
facebook.friend_count_by_age_months_2
```

## Noise in Conditional Means
```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_Noise}
ggplot(data = subset(facebook.friend_count_by_age_months, age_with_months < 71),
       aes(x = age_with_months, y = friend_count_mean)) +
  geom_line()
```

# Smoothing Conditional Means
```{r echo=FALSE, message=FALSE, warning=FALSE, Conditional_Means_Smoothing}
plot_1 <- ggplot(data = subset(facebook.friend_count_by_age,
                     age < 71),
       aes(x = age, y = friend_count_mean)) +
  geom_line() +
  geom_smooth()

plot_2 <- ggplot(data = subset(facebook.friend_count_by_age_months,
                     age_with_months < 71),
       aes(x = age_with_months, y = friend_count_mean)) +
  geom_line() +
  geom_smooth()

plot_3 <- ggplot(data = subset(facebook, age <71),
                 aes(x = round(age/5)*5, y = friend_count)) +
  geom_line(stat = 'summary', fun.y = mean)


grid.arrange(plot_2, plot_1, plot_3, ncol = 1)
```

## Third Qualitative Variable
```{r}
ggplot(data = subset(facebook, !is.na(gender)),
       aes(x = gender, y = age)) +
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = "point", shape = 4)

ggplot(data = subset(facebook, !is.na(gender)),
       aes(x = age, y = friend_count)) +
  geom_line(aes(color = gender), stat = "summary", fun.y = median)

friend_count_by_age_gender <- facebook %>%
  filter(!is.na(gender)) %>%
  group_by(age, gender) %>%
  summarise(mean_friend_count = mean(friend_count),
            median_friend_count = median(as.numeric(friend_count)),
            n = n()) %>%
  ungroup() %>%
  arrange(age)
```

## Plotting Conditional Summaries
```{r}
ggplot(data = friend_count_by_age_gender,
      aes(x = age, y = median_friend_count)) +
  geom_line(aes(color= gender))
```

```{r}
friend_count_by_age_gender_wide <- spread(subset(friend_count_by_age_gender, 
               select = c('gender', 'age', 'median_friend_count')),
        gender,
        median_friend_count)

friend_count_by_age_gender_wide
```

## Ratio Plot
```{r}
ggplot(data = friend_count_by_age_gender_wide,
       aes(x = age, y = female/male)) +
  geom_line() +
  geom_hline(yintercept = 1, alpha = 0.3, linetype = 2)
```

## Third Quantitative Variable
```{r}
facebook$year_joined <- floor(2014 - facebook$tenure/365)
```

## Cut a Variable
```{r}
summary(facebook$year_joined)
table(facebook$year_joined)

facebook$year_joined_bucket <- cut(facebook$year_joined,
                                   c(2004, 2009, 2011, 2012, 2014))
```

## Plotting It All Together
```{r}
table(facebook$year_joined_bucket, useNA = 'ifany')

ggplot(data = subset(facebook, !is.na(year_joined_bucket)),
       aes(x = age, y = friend_count)) + 
  geom_line(aes(color = year_joined_bucket),
            stat = 'summary', 
            fun.y = median)
```

## Plot the Grand Mean
```{r}
ggplot(data = subset(facebook, !is.na(year_joined_bucket)),
       aes(x = age, y = friend_count)) + 
  geom_line(stat = 'summary',
            fun.y = mean,
            aes(color = year_joined_bucket)) +
  geom_line(stat = 'summary', 
            fun.y = mean, 
            linetype = 2)
```

## Friending Rate
```{r}
with(subset(facebook, tenure >= 1), summary(friend_count/tenure))
```

## Friendships Initiated
```{r}
ggplot(data = subset(facebook, tenure >= 1),
       aes(x = tenure, y = friendships_initiated / tenure)) +
  geom_line(stat = 'summary',
            fun.y = mean,
            aes(color = year_joined_bucket))
```

## Bias-Variance Tradeoff Revisited
```{r}
ggplot(data = subset(facebook, tenure >= 1),
       aes(x = tenure, y = friendships_initiated / tenure)) +
  geom_smooth(aes(color = year_joined_bucket))
```

## Scatterplot Matrices
```{r}
theme_set(theme_minimal(20))
set.seed(1836)
facebook_subset <- facebook[, c(2,6:12)]
names(facebook_subset)
ggpairs(facebook_subset[sample.int(nrow(facebook_subset), 1000),])

with(facebook_subset, cor.test(friendships_initiated, friend_count, method = 'pearson'))
with(facebook_subset, cor.test(age, mobile_likes, method = 'pearson'))
```

## Proportion of Friendships Initiated
```{r}
names(facebook)
facebook$prop_initiated <- facebook$friendships_initiated/facebook$friend_count
```

## Proportion Initiated Vs. Tenure
```{r}
facebook$year_joined_bucket <- cut(facebook$year_joined,
                                   c(2004, 2009, 2011, 2012, 2014))

ggplot(data = facebook,
       aes(x = tenure, y = prop_initiated)) +
  geom_line(stat = "summary",
            fun.y = median,
            aes(color = year_joined_bucket))
```


## Smoothing Proportion Initiated vs. Tenure
```{r}
ggplot(data = facebook,
       aes(x = tenure, y = prop_initiated)) +
  geom_line(stat = "summary",
            fun.y = median,
            aes(color = year_joined_bucket)) + 
  geom_smooth()

subset_facebook <- subset(facebook, year_joined > 2012)
summary(subset_facebook$prop_initiated)
```